{% extends "apps/layouts/base.html" %}
{% load static %}

{% block content %}
<div class="voyage-single-container" style="display: flex; gap: 40px; padding: 20px;">

    <!-- Colonne gauche -->
    <div class="left-column" style="flex: 1; max-width: 350px;">
        <div class="conducteur-card" style="border: 1px solid #ddd; border-radius: 10px; padding: 20px; text-align: center;">
            {% if voyage.conducteur.profilutilisateur.photo_profil %}
                <img src="{{ voyage.conducteur.profilutilisateur.photo_profil.url }}" 
                     alt="{{ voyage.conducteur.username }}" 
                     style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; margin-bottom: 15px;">
            {% endif %}
            <h3>{{ voyage.conducteur.username }}</h3>
            {% if voyage.conducteur.profilutilisateur.bio %}
                <p>{{ voyage.conducteur.profilutilisateur.bio }}</p>
            {% endif %}

            <div class="note-moyenne" style="margin-top:10px;">
                {% if moyenne_avis %}
                    <p><strong>Note moyenne :</strong> {{ moyenne_avis|floatformat:1 }} / 5 ⭐
                        — <a href="{% url 'apps:conducteur_avis' voyage.conducteur.id %}">Voir tous les avis</a>
                    </p>
                {% else %}
                    <p>Aucun avis — <a href="{% url 'apps:conducteur_avis' voyage.conducteur.id %}">Voir les avis</a></p>
                {% endif %}
            </div>
        </div>

        {% if voyage.conducteur.voitures.exists %}
        <div class="voiture-card" style="border: 1px solid #ddd; border-radius: 10px; padding: 20px; margin-top: 20px; text-align: center;">
            {% with voiture=voyage.conducteur.voitures.first %}
                {% if voiture.photo %}
                    <img src="{{ voiture.photo.url }}" alt="{{ voiture.marque }} {{ voiture.modele }}" 
                         style="width: 100%; border-radius: 10px; object-fit: cover; margin-bottom: 10px;">
                {% endif %}
                <h4>{{ voiture.marque }} {{ voiture.modele }}</h4>
                <p>Immatriculation : {{ voiture.immatriculation }}</p>
                <p>Places : {{ voiture.nombre_places }}</p>
                {% if voiture.couleur %}<p>Couleur : {{ voiture.couleur }}</p>{% endif %}
            {% endwith %}
        </div>
        {% endif %}
    </div>

    <!-- Colonne droite -->
    <div class="right-column" style="flex: 2; display: flex; flex-direction: column; gap: 20px;">
        <div class="voyage-details" style="border: 1px solid #ddd; border-radius: 10px; padding: 30px; text-align: center;">
            
            <!-- Titre centré -->
            <h2 style="margin-bottom: 30px;">{{ voyage.titre }}</h2>

            <!-- Infos principales en deux colonnes -->
            <div style="display: flex; justify-content: space-between; text-align: left; gap: 40px;">
                <!-- Colonne gauche -->
                <div style="flex: 1;">
                    <p><strong>Départ :</strong> {{ voyage.depart }}</p>
                    <p><strong>Arrivée :</strong> {{ voyage.arrivee }}</p>
                    <p><strong>Date :</strong> {{ voyage.date_depart|date:"d/m/Y H:i" }}</p>
                    <p><strong>Places restantes :</strong> {{ voyage.nb_places_restantes }}</p>
                    <p><strong>Prix :</strong> {{ voyage.prix }} €</p>
                </div>

                <!-- Colonne droite -->
                <div style="flex: 1;">
                    <p><strong>Écologique :</strong> {% if voyage.ecologique %}Oui{% else %}Non{% endif %}</p>
                    <p><strong>État :</strong> {{ voyage.get_etat_display }}</p>
                    {% if distance_km %}
                        <p><strong>Distance :</strong> {{ distance_km }} km</p>
                    {% endif %}
                    {% if duree_h %}
                        <p><strong>Durée estimée :</strong> {{ duree_h }} h</p>
                    {% endif %}
                </div>
            </div>

            <!-- Description au centre -->
            <div style="margin-top: 30px; font-style: italic;">
                <p>{{ voyage.description }}</p>
            </div>

            <!-- Bouton centré -->
            <form method="post" action="{% url 'apps:reserver_voyage' voyage.id %}" style="margin-top: 20px;">
                {% csrf_token %}
                <button type="submit" style="background-color: #007BFF; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-size: 1em;">
                    Réserver
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}


